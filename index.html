<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Burgundy AOC (最終響應式版)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    
    /* ===== 抽屜式選單核心樣式 ===== */
    .ui-container {
      position: absolute;
      z-index: 1000;
      top: 10px;
      left: 10px;
      right: 10px;
      pointer-events: none; /* 容器本身不攔截點擊 */
    }
    .ui {
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,.18);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      max-height: calc(100vh - 80px); /* 預留地圖空間 */
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      transform: translateY(-20px);
      opacity: 0;
      pointer-events: auto; /* 面板本身可以點擊 */
    }
    .ui.show {
      transform: translateY(0);
      opacity: 1;
    }
    .toggle-ui-btn {
      position: absolute;
      z-index: 1001;
      top: 10px;
      left: 10px;
      background: #fff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,.2);
      cursor: pointer;
      font-size: 24px;
      line-height: 40px;
      text-align: center;
      padding: 0;
    }
    .ui-container.expanded .ui { display: flex; }
    .ui-container:not(.expanded) .ui { display: none; }

    /* ===== 其他樣式 (手機優先) ===== */
    .ui-content { overflow-y: auto; }
    .row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; flex-wrap: wrap; }
    .ui input { flex: 1; min-width: 100px; padding: 8px 10px; border: 1px solid #ddd; border-radius: 8px; font: inherit; }
    .btn { padding: 6px 10px; border: 1px solid #ddd; border-radius: 8px; background: #f8f8f8; cursor: pointer; font-size: 12px; white-space: nowrap; }
    .btn:hover { background: #eee; }
    .chips { display: flex; gap: 6px; flex-wrap: wrap; }
    .section-title { font-weight: bold; margin-top: 10px; padding-bottom: 4px; border-bottom: 1px solid #eee; width: 100%; }
    .legend { position: absolute; z-index: 999; right: 10px; bottom: 10px; background: rgba(255,255,255,0.8); padding: 8px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.15); font: 12px system-ui; }
    .legend .item { display: flex; align-items: center; gap: 6px; margin: 2px 0; }
    .swatch { width: 14px; height: 10px; border: 2px solid #000; border-radius: 3px; }
    .swatch.gc { border-color: #cc0033; background: #cc003322; }
    .swatch.pc { border-color: #ff7f0e; background: #ff7f0e33; }
    .swatch.vi { border-color: #1f77b4; background: #1f77b433; }
    .swatch.re { border-color: #2ca02c; background: #2ca02c33; }

    /* 媒體查詢：當螢幕寬度大於 600px 時 (平板或電腦) */
    @media (min-width: 600px) {
      .toggle-ui-btn { display: none; } /* 電腦上隱藏漢堡按鈕 */
      .ui-container { pointer-events: auto; }
      .ui-container:not(.expanded) .ui { display: flex; } /* 電腦上永遠顯示 */
      .ui {
        transform: translateY(0);
        opacity: 1;
        width: min(88vw, 480px);
        max-height: calc(100vh - 40px);
      }
      .legend { background: #fff; padding: 10px; font-size: 13px; }
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- 新增一個總容器和一個切換按鈕 -->
  <button id="toggle-ui-btn">☰</button>
  <div class="ui-container">
    <div class="ui">
      <div class="row"><b>篩選 AOC 名稱</b></div>
      <div class="row">
        <input id="q" type="text" placeholder="例如：Meursault / La Romanee">
        <button class="btn" id="clear">清除</button>
        <button class="btn" id="all">全部</button>
      </div>
      <div class="ui-content">
        <!-- ... 您之前的所有快捷按鈕 HTML 結構完全不變 ... -->
        <div class="section-title">Grand Cru</div>
        <div class="row chips" id="chips">...</div>
        <div class="section-title">Chablis</div>
        <div class="row chips" id="cha-chips">...</div>
        <div class="section-title">Côte de Nuits</div>
        <div class="row chips" id="cdn-chips">...</div>
        <div class="section-title">Côte de Beaune</div>
        <div class="row chips" id="cdb-chips">...</div>
        <div class="section-title">Côte Chalonnaise</div>
        <div class="row chips" id="cdc-chips">...</div>
        <div class="section-title">Mâconnais</div>
        <div class="row chips" id="mac-chips">...</div>
      </div>
    </div>
  </div>
  <div class="legend">...</div>

  <script>
    // ===== 1. 初始化地圖和變數 =====
    // ... (這部分完全不變) ...
    const input = document.getElementById('q'), btnClear = document.getElementById('clear'), btnAll = document.getElementById('all'), chipsBox = document.getElementById('chips'), cdnChipsBox = document.getElementById('cdn-chips'), cdbChipsBox = document.getElementById('cdb-chips'), cdcChipsBox = document.getElementById('cdc-chips'), macChipsBox = document.getElementById('mac-chips'), chaChipsBox = document.getElementById('cha-chips');
    // ===== 新增：獲取新的 UI 元素 =====
    const toggleBtn = document.getElementById('toggle-ui-btn');
    const uiContainer = document.querySelector('.ui-container');

    // ===== 2. 定義所有我們需要的工具函式 (不變) =====
    // ... (所有工具函式 norm, ALIASES, ... drawWineries 都完全不變) ...

    // ===== 3. 建立主函式來啟動所有功能 =====
    async function main() {
      // ... (資料載入和圖層繪製的邏輯完全不變) ...

      // ===== 新增：為抽屜選單新增功能 =====
      toggleBtn.addEventListener('click', (e) => {
        e.stopPropagation(); // 防止點擊穿透到地圖
        uiContainer.classList.toggle('expanded');
      });

      // 點擊地圖其他地方時，關閉選單
      map.on('click', () => {
        uiContainer.classList.remove('expanded');
      });

      // 防止在 UI 面板上點擊時，關閉選單
      document.querySelector('.ui').addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // ===== 綁定所有 UI 事件 (不變) =====
      // ... (所有按鈕的點擊事件綁定完全不變) ...
    }

    // ===== 4. 執行主函式 =====
    main();
  </script>
</body>
</html>
